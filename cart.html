<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Portfolio - Cart</title>
<link rel="stylesheet" href="css/main.css">
  <link href="https://fonts.googleapis.com/css2?family=Pangolin&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Palanquin:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Erica+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lalezar&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">
<style>
    .cart-item-image {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 4px;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
      gap: 30px; /* добавляем это */
    }
    .cart-item-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    /* ОСТАВЬ ТОЛЬКО ЭТОТ БЛОК ДЛЯ quantity-controls */
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 5px;
    }

    /* Скрываем кнопки +/- */
    .quantity-btn {
      display: none !important;
    }

    /* Стили для текста количества */
    .quantity {
      font-weight: bold;
      color: #333;
      font-size: 14px;
    }

    .cart-item-price {
      font-weight: bold;
      font-size: 16px;
      margin-left: auto; /* добавляем это */
  padding-right: 20px; /* и это */
    }
    
    .remove-item {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #ff5252;
        margin-right: 15px; /* ← ДОБАВЬ ЭТУ СТРОКУ */
    }
    .cart-total {
      text-align: right;
      margin-top: 20px;
      font-weight: bold;
      font-size: 18px;
    }
    #contact-field {
      margin-top: 15px;
    }
</style>
</head>
<body>
  <div class="wrapper">
    <!-- Шапка -->
    <header>
      <div class="header-top">
        <a href="index.html" class="logo-container">
          <img src="girl-frog-psd.png" alt="Logo" class="logo">
          <div class="logo-text">Olga Qekkel</div>
        </a>
      </div>
      <nav class="header-bottom">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="store.html">Store</a>
        <a href="contact.html">Contact</a>
        <a href="cart.html" class="cart-link">Cart<span id="cart-count" class="cart-count">0</span></a>
      </nav>
    </header>

    <main class="cart-container">
      <h1>Your Order</h1>
      
      <div id="cart-content">
        <!-- Сюда будет вставлено содержимое корзины -->
        <div id="cart-empty" style="display: none;">
          <p>Your cart is empty</p>
          <a href="store.html" class="btn">Back to Store</a>
        </div>
        
        <div id="cart-items">
          <ul id="cart-list"></ul>
          <div class="cart-total">
            <p>Total: <span id="cart-total-price">$0.00</span></p>
          </div>
        </div>
      </div>

      <form id="order-form" action="https://formspree.io/f/xvgrvwlv" method="POST" style="display: none;">
        <h2>Contact Information</h2>
        
        <div class="form-group">
          <label for="name">Your Name:</label>
          <input type="text" name="name" placeholder="Your Name" required>
        </div>

        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" name="email" placeholder="Email" required>
        </div>
        
        <!-- Поле для предпочтительного способа связи -->
        <div class="form-group">
          <label>Preferred contact method:</label>
          <select name="contact_method" id="contact-method" required>
            <option value="">Select option</option>
            <option value="telegram">Telegram</option>
            <option value="whatsapp">WhatsApp</option>
            <option value="email">Email Only</option>
          </select>
        </div>

        <!-- Поле для Telegram/WhatsApp/Phone -->
        <div class="form-group" id="contact-field" style="display: none;">
          <label id="contact-label">Contact info</label>
          <input type="text" name="contact_info" placeholder="@username or +123456789">
        </div>

        <div class="form-group">
          <label for="address">Shipping Address:</label>
          <textarea id="address" name="address" rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="comment">Order Notes:</label>
          <textarea id="comment" name="comment" rows="3"></textarea>
        </div>
        
        <input type="hidden" name="cart" id="cart-data">
        <input type="hidden" name="_subject" value="New Order from Qekkel.com">
        <button type="submit" class="btn">Place Order</button>
      </form>
        </div> <!-- Добавьте эту строку -->
    </main>

    <!-- Футер -->
    <footer>
      <p>© 2025 Olga Boiko</p>
    </footer>
  </div>

  <script>
  let deletedItem = null;
  let undoTimeout = null;

  document.addEventListener('DOMContentLoaded', function() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const cartList = document.getElementById('cart-list');
    const cartEmpty = document.getElementById('cart-empty');
    const cartItems = document.getElementById('cart-items');
    const orderForm = document.getElementById('order-form');
    const totalPriceEl = document.getElementById('cart-total-price');
    const cartData = document.getElementById('cart-data');
    const contactMethod = document.getElementById('contact-method');
    const contactField = document.getElementById('contact-field');

    // Функция для получения корректного пути к изображению
    function getCorrectImagePath(imgPath) {
      if (!imgPath) return 'images/placeholder-image.jpg';
      if (imgPath.startsWith('http')) return imgPath;
      
      const baseUrl = window.location.origin;
      if (imgPath.startsWith('/')) {
        return baseUrl + imgPath;
      } else {
        return baseUrl + '/store/' + imgPath;
      }
    }

    // Обновляем счетчик корзины
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const count = cart.reduce((total, item) => total + item.quantity, 0);
      document.getElementById('cart-count').textContent = count;
    }

    // Обработчик изменения способа связи
    contactMethod.addEventListener('change', function() {
      if (this.value === 'telegram' || this.value === 'whatsapp') {
        contactField.style.display = 'block';
        document.getElementById('contact-label').textContent = 
          this.value === 'telegram' ? 'Telegram username (@)' : 'WhatsApp number (+...)';
      } else {
        contactField.style.display = 'none';
      }
    });

    // Функция показа уведомления на месте товара
   function showUndoNotification(itemName, itemId, itemElement) {
  console.log('Показываем уведомление для:', itemName);
  
  const notification = document.createElement('li');
  notification.className = 'undo-notification';
  notification.innerHTML = `
    <span>Вы удалили "${itemName}"</span>
    <div style="display: flex; align-items: center; gap: 15px;">
      <span class="countdown">4</span>
      <button class="undo-btn" data-id="${itemId}">Вернуть</button>
    </div>
  `;
  
  itemElement.replaceWith(notification);
  
  let seconds = 4;
  const countdownEl = notification.querySelector('.countdown');
  const countdownInterval = setInterval(() => {
    seconds--;
    
    // Анимация изменения цифры
    countdownEl.classList.add('changing');
    setTimeout(() => {
      countdownEl.textContent = seconds;
      countdownEl.classList.remove('changing');
    }, 150);
    
    // Плавное изменение стиля при уменьшении времени
    if (seconds <= 2) {
      notification.classList.add('counting');
    }
    
    if (seconds <= 0) {
      clearInterval(countdownInterval);
      
      // Плавное исчезновение
      notification.classList.add('fade-out');
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
        deletedItem = null;
        displayCart();
      }, 400); // Совпадает с длительностью анимации исчезновения
    }
  }, 1000);
  
  undoTimeout = countdownInterval;
}
    // Обработчик кнопки "Вернуть" (делегирование)
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('undo-btn')) {
        const itemId = e.target.getAttribute('data-id');
        console.log('Нажата кнопка Вернуть для:', itemId);
        
        if (deletedItem && deletedItem.id === itemId) {
          let cart = JSON.parse(localStorage.getItem('cart')) || [];
          cart.push(deletedItem);
          localStorage.setItem('cart', JSON.stringify(cart));
          
          // Очищаем таймер
          clearInterval(undoTimeout);
          
          // Обновляем отображение
          displayCart();
          deletedItem = null;
        }
      }
    });

    // Отображаем содержимое корзины
    function displayCart() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      cartList.innerHTML = '';
      let totalPrice = 0;

      if (cart.length === 0) {
        cartEmpty.style.display = 'block';
        cartItems.style.display = 'none';
        orderForm.style.display = 'none';
      } else {
        cartEmpty.style.display = 'none';
        cartItems.style.display = 'block';
        orderForm.style.display = 'block';

        cart.forEach(item => {
          const li = document.createElement('li');
          li.className = 'cart-item';
          
          const getImagePath = (imgPath) => {
            if (!imgPath) return 'images/default-product.png';
            if (window.location.host.includes('github.io')) {
              return `https://qekkel.github.io/my-website/${imgPath.startsWith('store/') ? imgPath : 'store/' + imgPath}`;
            }
            return imgPath.startsWith('store/') ? imgPath : 'store/' + imgPath;
          };

          const imagePath = getImagePath(item.image);
          
          li.innerHTML = `
            <div class="cart-item-info">
              <img src="${imagePath}" 
                   alt="${item.name}" 
                   class="cart-item-image"
                   onerror="this.src='images/default-product.png'">
              <div>
                <span class="cart-item-name">${item.name}</span>
                <div class="quantity-controls">
                  <span class="quantity">Quantity: ${item.quantity}</span>
                </div>
              </div>
            </div>
            <div class="cart-item-price">$${(item.price * item.quantity).toFixed(2)}</div>
            <button class="remove-item" data-id="${item.id}">×</button>
          `;
          
          cartList.appendChild(li);
          totalPrice += item.price * item.quantity;
        });

        totalPriceEl.textContent = `$${totalPrice.toFixed(2)}`;
        cartData.value = JSON.stringify(cart);
      }
      updateCartCount();
    }

    // Обработчик удаления товара
    cartList.addEventListener('click', function(e) {
      const itemId = e.target.getAttribute('data-id');
      if (!itemId) return;

      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const itemIndex = cart.findIndex(item => item.id === itemId);
      
      if (e.target.classList.contains('remove-item')) {
        console.log('Удаляем товар с ID:', itemId);
        
        // Сохраняем удаляемый товар и элемент
        deletedItem = cart[itemIndex];
        const itemElement = e.target.closest('li');
        
        // Удаляем из корзины
        cart.splice(itemIndex, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        
        // Показываем уведомление на месте товара
        showUndoNotification(deletedItem.name, itemId, itemElement);
      }
    });

    // Обработчик отправки формы
    document.getElementById('order-form').addEventListener('submit', function() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      let message = "ORDER DETAILS:\n\n";
      
      cart.forEach(item => {
        message += `- ${item.quantity} × ${item.name} ($${item.price} each)\n`;
      });
      
      document.getElementById('cart-data').value = message;
    });

    // Инициализация
    displayCart();
  });
</script>